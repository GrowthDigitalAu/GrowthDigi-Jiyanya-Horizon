{% comment %}
UNIVERSAL DESCRIPTION CLEANER
- Fix broken HTML
- Remove inline styles
- Detect bullets automatically
- If no bullets → create clean paragraphs
- Never break layout
{% endcomment %}

{%- comment -%} 1) Clean raw description text {%- endcomment -%}
{% assign text = product.description 
  | replace: '_x000D_', ' ' 
  | replace: '\n', ' '
  | replace: '\\n', ' '
  | replace: '\r', ' '
  | strip_html
  | strip
%}

{%- comment -%} 2) Check if description contains bullets (•) {%- endcomment -%}
{% assign has_bullets = text contains '•' %}

<div class="product_discription_new">

  {% if has_bullets %}
    {%- comment -%} BULLET MODE {%- endcomment -%}
    {% assign parts = text | split: '•' %}

    <h3>{{ parts.first | strip }}</h3>

    <ul>
      {% for item in parts offset:1 %}
        {% assign cleaned = item | strip %}
        {% if cleaned != '' %}
          <li>{{ cleaned }}</li>
        {% endif %}
      {% endfor %}
    </ul>

  {% else %}

    {%- comment -%} PARAGRAPH MODE (NO BULLETS) {%- endcomment -%}

    {% assign sentences = text | split: '. ' %}

    {% for s in sentences %}
      {% assign p = s | strip %}
      {% if p != '' %}
        <p>{{ p }}.</p>
      {% endif %}
    {% endfor %}

  {% endif %}

</div>
